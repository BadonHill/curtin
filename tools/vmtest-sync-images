#!/bin/bash
set -eux
# This tool keeps a local copy of the maas images used by vmtests.
# It keeps only the latest copy of the available images.

# Example command:
#sstream-mirror --max=1 --keyring=/usr/share/keyrings/ubuntu-cloudimage-keyring.gpg
#http://maas.ubuntu.com/images/ephemeral-v2/daily/streams/v1/index.sjson /tmp/sstream-mirror arch=amd64 item_name=root-image.gz

IMAGE_URL="http://maas.ubuntu.com/images/ephemeral-v2/daily/streams/v1/index.sjson"
IMAGE_STORE="/srv/images"
FILTERS="arch=amd64 item_name=root-image.gz"

sstream-mirror --max=1 --keyring=/usr/share/keyrings/ubuntu-cloudimage-keyring.gpg \
${IMAGE_URL} ${IMAGE_STORE} ${FILTERS}
